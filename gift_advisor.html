<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Gift with AI — Gift Advisor</title>

  <!-- Google Tag Manager (head) - container GTM-T8TBW4QT -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-T8TBW4QT');</script>
  <!-- End Google Tag Manager (head) -->

  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      --bg:#fafafa; --card:#ffffff; --muted:#6b7280; --accent:#0b66c3; --accent-2:#0a58a8;
      --ok:#16a34a; --glass: rgba(11,102,195,0.06);
      --radius:12px; --pad:14px;
      --shadow: 0 6px 18px rgba(15,23,42,0.06);
    }
    html,body{height:100%; margin:0; font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background:var(--bg); color:#0f172a;}
    .wrap{max-width:1040px;margin:28px auto;padding:20px;}
    header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:18px}
    h1{font-size:20px;margin:0}
    #catalogBanner{background:#fff8e6;color:#5a3d00;border:1px solid #f1d7a7;padding:8px 12px;border-radius:8px;font-size:13px}
    .panel{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);padding:var(--pad);}

    /* Form layout */
    #advisorForm{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:12px;align-items:end}
    .field{display:flex;flex-direction:column;gap:6px}
    label.lbl{font-size:13px;color:var(--muted)}
    select, button, input{font-size:15px;padding:10px;border-radius:10px;border:1px solid #e6e9ef;background:white}
    select{appearance:none;background-image:linear-gradient(45deg,transparent 50%, #9aa6c3 50%), linear-gradient(135deg, #9aa6c3 50%, transparent 50%); background-position:calc(100% - 16px) calc(1em + 2px), calc(100% - 10px) calc(1em + 2px); background-size:6px 6px, 6px 6px; background-repeat:no-repeat;}
    .generate-col{grid-column:span 1; display:flex;align-items:center;justify-content:center}
    #generateBtn{background:linear-gradient(180deg,var(--accent),var(--accent-2));color:white;border:none;padding:12px 18px;border-radius:12px;cursor:pointer;box-shadow:0 6px 16px rgba(11,102,195,0.12);transition:transform .12s linear}
    #generateBtn:active{transform:translateY(1px)}
    .small{font-size:13px;color:var(--muted);margin-top:8px}

    /* Results grid */
    #resultsGrid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:12px;margin-top:18px}
    .card{background:var(--card);border-radius:12px;padding:12px;display:flex;gap:12px;align-items:flex-start;border:1px solid #f1f5f9}
    .thumb{width:100px;height:70px;border-radius:8px;flex:0 0 100px;object-fit:cover;background:linear-gradient(135deg,#eef2ff,#fff)}
    .meta{flex:1;display:flex;flex-direction:column;gap:6px}
    .title{font-weight:600;color:#0f172a;font-size:15px}
    .desc{font-size:13px;color:var(--muted);line-height:1.2}
    .row{display:flex;align-items:center;justify-content:space-between;gap:8px}
    .price{font-weight:700;color:#111}
    .rating{background:var(--glass);padding:6px 8px;border-radius:999px;font-size:13px;color:var(--accent)}
    .view{margin-top:8px;display:inline-block;background:transparent;border:1px dashed #dbeafe;color:var(--accent);padding:6px 10px;border-radius:8px;text-decoration:none;cursor:pointer}
    .view:hover{background:#eef6ff}
    .skeleton{height:86px;border-radius:12px;background:linear-gradient(90deg,#f6f7fb,#eef1f7,#f6f7fb);animation:shimmer 1.4s linear infinite}
    @keyframes shimmer{0%{background-position:-200px 0}100%{background-position:200px 0}}

    /* Empty */
    .empty{padding:18px;border-radius:10px;border:1px dashed #e6eefc;background:linear-gradient(180deg,#ffffff,#fbfdff);color:var(--muted);text-align:center}

    /* Responsive */
    @media (max-width:800px){#advisorForm{grid-template-columns:repeat(2,1fr)} .generate-col{grid-column:span 2}}
    @media (max-width:520px){#advisorForm{grid-template-columns:1fr} .generate-col{grid-column:span 1}}
  </style>
</head>
<body>
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T8TBW4QT"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  <div class="wrap">
    <header>
      <h1>Gift with AI — Gift Advisor</h1>
      <div id="catalogBanner">Suggestions generated from our catalog — enrichment disabled.</div>
    </header>

    <section class="panel">
      <form id="advisorForm" onsubmit="return false;">
        <div class="field">
          <label class="lbl">Recipient</label>
          <select id="recipient" name="Recipient" aria-label="Recipient">
            <option>Family Member</option>
            <option>Friend</option>
            <option>Co-worker</option>
            <option>Partner</option>
          </select>
        </div>

        <div class="field">
          <label class="lbl">Gender</label>
          <select id="gender" name="Gender" aria-label="Gender">
            <option>Any/Generic</option>
            <option>Male</option>
            <option>Female</option>
            <option>Non-binary</option>
          </select>
        </div>

        <div class="field">
          <label class="lbl">Budget</label>
          <select id="budget" name="Budget" aria-label="Budget">
            <option>Under $25</option>
            <option>$25–$50</option>
            <option>$50–$100</option>
            <option>$100+</option>
          </select>
        </div>

        <div class="field">
          <label class="lbl">Age</label>
          <select id="age" name="Age" aria-label="Age">
            <option>Adult (20-55)</option>
            <option>Young Adult (18-25)</option>
            <option>Senior (55+)</option>
            <option>Teen (13-19)</option>
          </select>
        </div>

        <div class="field">
          <label class="lbl">Occasion</label>
          <select id="occasion" name="Occasion" aria-label="Occasion">
            <option>Birthday</option>
            <option>Holiday</option>
            <option>Anniversary</option>
            <option>Just Because</option>
          </select>
        </div>

        <div class="field">
          <label class="lbl">Timeline</label>
          <select id="timeline" name="Timeline" aria-label="Timeline">
            <option>Immediate (1-3)</option>
            <option>1 week</option>
            <option>2+ weeks</option>
          </select>
        </div>

        <div class="generate-col">
          <button id="generateBtn" class="primary">Generate</button>
        </div>
        <div style="grid-column:1 / -1" class="small">Tip: try different budgets or recipient types for varied suggestions.</div>
      </form>
    </section>

    <section id="resultsArea" style="margin-top:18px;">
      <div id="resultsGrid" aria-live="polite">
        <!-- initial empty state -->
        <div class="empty">No suggestions yet. Choose options and click Generate.</div>
      </div>
    </section>
  </div>

  <script>
    // Ensure dataLayer exists for GTM
    window.dataLayer = window.dataLayer || [];

    // Collect answers
    function collectAnswers() {
      return {
        Recipient: document.getElementById('recipient')?.value || '',
        Gender: document.getElementById('gender')?.value || '',
        Budget: document.getElementById('budget')?.value || '',
        Age: document.getElementById('age')?.value || '',
        Occasion: document.getElementById('occasion')?.value || '',
        Timeline: document.getElementById('timeline')?.value || ''
      };
    }

    // Render helpers
    function renderSkeleton() {
      const grid = document.getElementById('resultsGrid');
      grid.innerHTML = '';
      for (let i=0;i<3;i++){
        const s = document.createElement('div');
        s.className = 'skeleton';
        grid.appendChild(s);
      }
    }

    function renderResults(items) {
      const grid = document.getElementById('resultsGrid');
      grid.innerHTML = '';
      if (!items || !items.length) {
        grid.innerHTML = '<div class="empty">No suggestions found for these options. Try changing budget or recipient.</div>';
        return;
      }

      items.forEach(item => {
        const card = document.createElement('div');
        card.className = 'card';

        const img = document.createElement('img');
        img.className = 'thumb';
        img.src = item.image || 'https://placehold.co/400x250?text=No+image';
        img.alt = item.productName || 'Product image';
        card.appendChild(img);

        const meta = document.createElement('div');
        meta.className = 'meta';

        const title = document.createElement('div');
        title.className = 'title';
        title.textContent = item.productName || 'Untitled product';
        meta.appendChild(title);

        const desc = document.createElement('div');
        desc.className = 'desc';
        desc.textContent = item.description || '';
        meta.appendChild(desc);

        const row = document.createElement('div');
        row.className = 'row';

        const price = document.createElement('div');
        price.className = 'price';
        price.textContent = item.price || '';
        row.appendChild(price);

        const rating = document.createElement('div');
        rating.className = 'rating';
        rating.textContent = (item.rating ? item.rating.toFixed(1) : '—') + (item.availability ? ' • ' + item.availability : '');
        row.appendChild(rating);

        meta.appendChild(row);

        // Affiliate link
        const a = document.createElement('a');
        a.href = item.affiliateUrl || '#';
        a.target = '_blank';
        a.rel = 'noopener noreferrer';
        a.className = 'view affiliate-link';
        a.dataset.productName = item.productName || '';
        a.textContent = 'View on Amazon';
        meta.appendChild(a);

        card.appendChild(meta);
        grid.appendChild(card);
      });
    }

    // Track generate + call worker
    async function generateRecommendations() {
      const answers = collectAnswers();
      const numRecommendations = 3;

      // GTM event
      window.dataLayer.push({ event:'generate', answers, numRecommendations });

      // loading skeleton
      renderSkeleton();

      try {
        const resp = await fetch('https://bold-lake-a224.moodysaleem.workers.dev/', {
          method: 'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify({ answers, interests: [], numRecommendations })
        });
        if (!resp.ok) throw new Error('Network response not OK: ' + resp.status);
        const data = await resp.json();
        renderResults(data.items || []);
      } catch (err) {
        console.error(err);
        const grid = document.getElementById('resultsGrid');
        grid.innerHTML = '<div class="empty">Unable to fetch suggestions right now. Please try again.</div>';
      }
    }

    // affiliate click tracking (delegated)
    document.addEventListener('click', function(e){
      const el = e.target.closest && e.target.closest('a.affiliate-link');
      if (!el) return;
      e.preventDefault();
      const href = el.href;
      const productName = el.dataset.productName || '';

      window.dataLayer.push({ event:'affiliate_click', productName, affiliateUrl: href });
      setTimeout(()=> window.open(href, '_blank', 'noopener,noreferrer'), 150);
    });

    // wire up generate button
    document.getElementById('generateBtn').addEventListener('click', function(e){
      e.preventDefault();
      generateRecommendations();
    });

    // initial GTM pageview-like event
    window.dataLayer.push({ event:'gift_advisor_pageview' });
  </script>
</body>
</html>
